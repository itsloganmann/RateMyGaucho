<!DOCTYPE html>
<html>
<head>
    <meta charset="UTF-8">
    <title>RateMyGaucho NLP Search Test</title>
    <style>
        body { font-family: monospace; margin: 20px; background: #f5f5f5; }
        .test { background: white; padding: 15px; margin: 10px 0; border-radius: 5px; }
        .pass { border-left: 5px solid #4caf50; }
        .fail { border-left: 5px solid #f44336; }
        h2 { color: #003660; }
        pre { background: #f9f9f9; padding: 10px; overflow-x: auto; }
        .result { font-weight: bold; }
    </style>
</head>
<body>
    <h1>RateMyGaucho NLP Search Improvements Test</h1>
    <div id="results"></div>

    <script>
        // Copy of parseNaturalQuery function with improvements
        function parseNaturalQuery(queryText) {
            const query = queryText.toLowerCase();
            const result = {
                days: [],
                timeRange: { start: null, end: null },
                difficulty: null,
                departments: [],
                level: null,
                keywords: [],
                exactCourseCode: null
            };
            
            // Extract difficulty
            if (query.includes('easy') || query.includes('easier')) {
                result.difficulty = 'easy';
            } else if (query.includes('hard') || query.includes('difficult')) {
                result.difficulty = 'hard';
            } else if (query.includes('moderate') || query.includes('medium')) {
                result.difficulty = 'moderate';
            }
            
            // Extract exact course codes first (e.g., "CMPSC 130A", "MATH 2A")
            const courseCodePattern = /\b([A-Z]{2,8})\s+(\d+[A-Z]*)\b/i;
            const courseCodeMatch = queryText.match(courseCodePattern);
            if (courseCodeMatch) {
                result.exactCourseCode = `${courseCodeMatch[1].toUpperCase()} ${courseCodeMatch[2].toUpperCase()}`;
            }
            
            // Department aliases mapping
            const deptAliases = {
                'cs': 'CMPSC',
                'compsci': 'CMPSC',
                'compeng': 'CMPEN',
                'ee': 'ECE',
                'me': 'ME',
                'ce': 'CE',
                'matsci': 'MATRL',
                'econ': 'ECON',
                'math': 'MATH',
                'bio': 'BIOL',
                'chem': 'CHEM',
                'phys': 'PHYS',
                'psych': 'PSY',
                'stats': 'PSTAT',
                'pstat': 'PSTAT',
                'comm': 'COMM',
                'art': 'ART',
                'music': 'MUS',
                'hist': 'HIST',
                'eng': 'ENGL',
                'phil': 'PHIL',
                'soc': 'SOC',
                'anth': 'ANTH',
                'geog': 'GEOG',
                'ling': 'LING',
                'span': 'SPAN',
                'french': 'FR',
                'german': 'GER',
                'japan': 'JAPAN',
                'chin': 'CHIN'
            };
            
            // Extract department codes from uppercase patterns (e.g., CMPSC, MATH, PSTAT)
            const deptPattern = /\b([A-Z]{2,8})\b/g;
            let deptMatch;
            while ((deptMatch = deptPattern.exec(queryText)) !== null) {
                result.departments.push(deptMatch[1]);
            }
            
            // Also check for department aliases in lowercase query
            for (const [alias, dept] of Object.entries(deptAliases)) {
                if (query.includes(alias)) {
                    if (!result.departments.includes(dept)) {
                        result.departments.push(dept);
                    }
                }
            }
            
            // Remove duplicates
            result.departments = [...new Set(result.departments)];
            
            return result;
        }

        // Test cases
        const tests = [
            {
                name: 'Extract uppercase department code',
                input: 'easy CMPSC classes',
                expectedDepts: ['CMPSC'],
                expectedDifficulty: 'easy',
                expectedExactCourse: null
            },
            {
                name: 'Extract lowercase cs alias',
                input: 'easy cs classes',
                expectedDepts: ['CMPSC'],
                expectedDifficulty: 'easy',
                expectedExactCourse: null
            },
            {
                name: 'Extract math alias',
                input: 'hard math courses',
                expectedDepts: ['MATH'],
                expectedDifficulty: 'hard',
                expectedExactCourse: null
            },
            {
                name: 'Extract stats/pstat alias',
                input: 'easy stats classes',
                expectedDepts: ['PSTAT'],
                expectedDifficulty: 'easy',
                expectedExactCourse: null
            },
            {
                name: 'Extract exact course code CMPSC 130A',
                input: 'CMPSC 130A reviews',
                expectedDepts: ['CMPSC'],
                expectedDifficulty: null,
                expectedExactCourse: 'CMPSC 130A'
            },
            {
                name: 'Extract exact course code MATH 2A',
                input: 'is MATH 2A easy?',
                expectedDepts: ['MATH'],
                expectedDifficulty: 'easy',
                expectedExactCourse: 'MATH 2A'
            },
            {
                name: 'Multiple department aliases',
                input: 'cs or econ classes',
                expectedDepts: ['CMPSC', 'ECON'],
                expectedDifficulty: null,
                expectedExactCourse: null
            },
            {
                name: 'psych alias for PSY',
                input: 'easy psych courses',
                expectedDepts: ['PSY'],
                expectedDifficulty: 'easy',
                expectedExactCourse: null
            },
            {
                name: 'bio alias for BIOL',
                input: 'hard bio classes',
                expectedDepts: ['BIOL'],
                expectedDifficulty: 'hard',
                expectedExactCourse: null
            },
            {
                name: 'No department specified',
                input: 'easy classes',
                expectedDepts: [],
                expectedDifficulty: 'easy',
                expectedExactCourse: null
            }
        ];

        // Run tests
        const resultsDiv = document.getElementById('results');
        let passed = 0;
        let failed = 0;

        tests.forEach((test, idx) => {
            const result = parseNaturalQuery(test.input);
            
            // Check all conditions
            const deptsMatch = JSON.stringify(result.departments.sort()) === JSON.stringify(test.expectedDepts.sort());
            const difficultyMatch = result.difficulty === test.expectedDifficulty;
            const exactCourseMatch = result.exactCourseCode === test.expectedExactCourse;
            
            const allMatch = deptsMatch && difficultyMatch && exactCourseMatch;
            
            if (allMatch) passed++;
            else failed++;

            const testDiv = document.createElement('div');
            testDiv.className = `test ${allMatch ? 'pass' : 'fail'}`;
            testDiv.innerHTML = `
                <h3>Test ${idx + 1}: ${test.name}</h3>
                <div><strong>Input:</strong> <code>${test.input}</code></div>
                <div><strong>Expected Departments:</strong> <code>${JSON.stringify(test.expectedDepts)}</code></div>
                <div><strong>Got Departments:</strong> <code>${JSON.stringify(result.departments)}</code> ${deptsMatch ? '✅' : '❌'}</div>
                <div><strong>Expected Difficulty:</strong> <code>${test.expectedDifficulty}</code></div>
                <div><strong>Got Difficulty:</strong> <code>${result.difficulty}</code> ${difficultyMatch ? '✅' : '❌'}</div>
                <div><strong>Expected Exact Course:</strong> <code>${test.expectedExactCourse}</code></div>
                <div><strong>Got Exact Course:</strong> <code>${result.exactCourseCode}</code> ${exactCourseMatch ? '✅' : '❌'}</div>
                <div class="result">${allMatch ? '✅ PASS' : '❌ FAIL'}</div>
            `;
            resultsDiv.appendChild(testDiv);
        });

        // Summary
        const summary = document.createElement('div');
        summary.className = 'test';
        summary.style.background = passed === tests.length ? '#e8f5e9' : '#ffebee';
        summary.innerHTML = `
            <h2>Test Summary</h2>
            <div><strong>Total:</strong> ${tests.length}</div>
            <div><strong>Passed:</strong> ${passed}</div>
            <div><strong>Failed:</strong> ${failed}</div>
            <div class="result">${passed === tests.length ? '✅ ALL TESTS PASSED' : '❌ SOME TESTS FAILED'}</div>
        `;
        resultsDiv.insertBefore(summary, resultsDiv.firstChild);
    </script>
</body>
</html>
